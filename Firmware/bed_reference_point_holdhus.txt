
#define X_PROBE_OFFSET_FROM_EXTRUDER (30.6 + 10)     // Z probe to nozzle X offset: -left  +right
#define Y_PROBE_OFFSET_FROM_EXTRUDER (11.6 - 10)   // Z probe to nozzle Y offset: -front +behind

0000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000
0000000000000000000f0d121b02000000000000000000000000000000000000
00000000000000001d31363532250b0000000000000000000000000000000000
000000000000000d311b34331b35290000000000000000000000000000000000
000000000000001b183428282e1b180f00000000000000000000000000000000
000000000000001d332e25102c1a001400000000000000000000000000000000
00000000000000182e3027292d1a340f00000000000000000000000000000000
000000000000000827001a001b1c270000000000000000000000000000000000
00000000000000001614191b34290b0000000000000000000000000000000000
000000000000000000090b1f1502000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000
0000000000000800000000000000000000000000000000000000000000000000
00000000000f1c05000000000000000000000000000000000000000000000000
0000000000000a05000000000000010000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000


#define X_PROBE_OFFSET_FROM_EXTRUDER (30.6 + 10)     // Z probe to nozzle X offset: -left  +right
#define Y_PROBE_OFFSET_FROM_EXTRUDER (11.6 - 8)   // Z probe to nozzle Y offset: -front +behind

0000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000
0000000000000000000e1d201801000000000000000000000000000000000000
00000000000000001c2f36353224080000000000000000000000000000000000
000000000000000b2d1a1a331a32200000000000000000000000000000000000
000000000000001a313229242a33160e00000000000000000000000000000000
000000000000001c322d2523131a331300000000000000000000000000000000
0000000000000019302f28261535300f00000000000000000000000000000000
0000000000000004241932181a36220000000000000000000000000000000000
00000000000000001527311a1829080000000000000000000000000000000000
00000000000000000005131c1000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000
0000000000000600000000000000000000000000000000000000000000000000
0000000000081604000000000000000000000000000000000000000000000000
0000000000000604000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000


#define X_PROBE_OFFSET_FROM_EXTRUDER (30.6 + 10)     // Z probe to nozzle X offset: -left  +right
#define Y_PROBE_OFFSET_FROM_EXTRUDER (11.6 - 5)   // Z probe to nozzle Y offset: -front +behind

0000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000
000000000000000000060b1e1000000000000000000000000000000000000000
00000000000000001a2e361a3125050000000000000000000000000000000000
000000000000000c311a35353533220000000000000000000000000000000000
000000000000001b34332e2c301a311000000000000000000000000000000000
000000000000001f343211272c351a1400000000000000000000000000000000
000000000000001a19192b292d1b001100000000000000000000000000000000
000000000000000a2a001a33351c2c0200000000000000000000000000000000
00000000000000001a2d3335352b0e0000000000000000000000000000000000
000000000000000000100e121e06000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000
0000000000000400000000000000000000000000000000000000000000000000
00000000000e1d05000000000000000000000000000000000000000000000000
0000000000010f05000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000

#define X_PROBE_OFFSET_FROM_EXTRUDER (30.6 + 10)     // Z probe to nozzle X offset: -left  +right
#define Y_PROBE_OFFSET_FROM_EXTRUDER (11.6 - 4)   // Z probe to nozzle Y offset: -front +behind

00000000000000000000121d0e00000000000000000000000000000000000000
0000000000000000173b4b4c4327000000000000000000000200000100000008
00000000000000244d6b3a7670623c0000000000000000000300000302000008
0000000000000449357979793c3b643300000000000000000000000300000004
0000000000001b2d75793c71773b734e0a000000000000000100000501000009
00000000000024603a386c6a6e79792e17000000000000000000000000000007
000400000000255d71706a696f3c785b15000000000000000000000300000008
0000000000000f4f6d7270717879724e03000000000000000000000100000006
000000000000003830703a7879745c2a00000000000000000000000100000001
000000000000000d1f5b346c6b58320000000000000000000000000201000006
000000000000000007283c213816000000000000000000000000000100000009
010000000000000000000000000000000000000000000000000000020000000a
000100000000000000000000000000000000000000000000040000040200000a
040400000430370d00000000000000000000000000000002060000050300000b
03070000184c5a3e00000000000000000000000000000004060000060300000c
0309000018462c4a1f000000002134321300000002000000060000050200000b
0405000010173e3620000000153a43202d02000005000001050000060300000a
040b0000001a12101309000016142b282005000009000001080000050400000b
050b0000000e0000050800000a10040d0f00000009000004090000050400000b
070c0000000a000000030000060600000b000000090000040900000b0300000c
0509010000090000000300000903000008000000060000050a0000060300000c
0a0f0300000b000001040000050400000a00000009000006090000060300000d
060b0300000b000001040000050400000b0000000a000004070000050400000c
0d110200000b000002060000070500000b0100000b0000070b0000070600000c
0c100600000b0000040b0000070700000b0200000b0000080c00000c0400000d
0d110600000b000003090000060600000b0100000b0000060a0000070600000c
0f0c0600010a0000060b0000060600000b0100010c0000080b0000070700000d
0e130500020b0000050b0000060400000c0000010a0000070b0000070600000d
0f120600040c0000060a000007070000070000000c0000070b0000070400000e
10130800040c0000060c0000080700000c0100000d00000a0b0000070500010e
11140800040c01000d0c0000070600000c0200010c00000b0b0000070500010d
13170c000b1000000f0b0000080500000f0300000c0000070c00000d0700020d


#define X_PROBE_OFFSET_FROM_EXTRUDER (30.6 + 10)     // Z probe to nozzle X offset: -left  +right
#define Y_PROBE_OFFSET_FROM_EXTRUDER (11.6 - 2)   // Z probe to nozzle Y offset: -front +behind

000000000000000000021b201b00000000000000000000000000000000000000
00000000000000002447585b503a04000000000000000001040000030200000a
00000000000000162e6f78797868460300000000000000000400000400000009
0000000000000a4b6f79797a7978663700000000000000010300000403000008
000000000000245f7778736d767a755106000000000000010300000300000006
0200000000002d6578766a696e79782e16000000000000010600000400000007
020000000000276276746e6c7179782d11000000000000000200000200000007
0200000000000f536e3b7675787a6e4900000000000000010400000300000007
020000000000003963743b7979735a2400000000000000010500000300000005
0200000000000006405c356c68542b0000000000000000010200000400000005
02000000000000000011183b310d000000000000000000000200000301000007
0302000000000000000000000000000000000000000000000500000301000007
030500000000020000000000000000000000000000000002090000060400000b
040a00000e3c431f00000000000000000000000000000003050000050400000a
040a02001e4d5f4708000000000000000000000001000003080000070500000b
010804001d4a5c4c25000000002c3f3d1900000006000004080000070600000c
050e060012301c34240600001b3e49442f080000090000050a0000060400000d
0b0f0200041b1110140a00001826282c2207000109000004070000070400000c
0b0c0500010a0000060a00000e0d02051001000009000004080000070500000c
0b100400000b000005090000060700000d020000080000050800000a0500000b
0c100700010a0000050a0000050500000b0100010a000006090000080500010c
0e110800030c0000050b0000070500000b0000020b0000070b0000080500010b
0d110700020c0000050b0000060700000d0200010a0000070b0000060500010d
0e130600040f000005090000060400000d0000030c0000070a0000070600010d
0f130600050c0000070c0000090900000f0300020d0100080b00000e0800020e
11140900050c02000c0c00000c090001100200020b0000080c00000f06000010
10140b000b1202000e0c00000e0800000e0200040e00000c0c00000e0700020f
0f140a0105120300090b00000f0800000b0200040b0100070b00000d0600020d
10160a000c110100090c00000f0a00010e0200030e0000090b00000f0600010e
12180b02071304000d0c00010e090000110300030d01000d0d00000d07000110
12170b000b1304000e0c00000f070001100400030b00000c0b00000e0700010f
121a0c010c1203020e0d00000e090001100500030e0000080a00000e06000311

#define X_PROBE_OFFSET_FROM_EXTRUDER (30.6 + 10)     // Z probe to nozzle X offset: -left  +right
#define Y_PROBE_OFFSET_FROM_EXTRUDER (11.6 - 6)   // Z probe to nozzle Y offset: -front +behind

000000000000000000000d120c00000000000000000000000000000000000000
00000000000000000d2d40443b1e000000000000000000020600000702000009
00000000000000194b676e736c5b35000000000000000001050000050200000a
00000000000000426c777b7b78745b2a00000000000000000200000400000009
000000000000192d773b3a3a783b702500000000000000000100000401000003
0000000000002663783b6d6b6f79795a12000000000000000400000300000009
030000000000266276756c6a6f793c2e16000000000000010400000603000007
0100000000001656713b6f7177793b4f05000000000000000600000600000006
00000000000000226976767a7a78663200000000000000000300000300000004
02000000000000174c336d7370611d0000000000000000000400000401000008
0000000000000000141b494b412600000000000000000000000000010000000a
020000000000000000000000000000000000000000000001050000010000000a
030300000000000000000000000000000000000000000002080000040100000c
030500000027000a00000000000000000000000000000001040000060300000c
030a0000194b583c00000000000000000000000000000002080000050300000c
030a00001b4b5b4d1f00000000192f280c00000006000004090000050400000c
03060000101b423d27000000121d49452d00000005000003080000060300000c
000d02000a0d0d0c1a08000017323331250a00000a000001070000060300000c
01090100000f03000809000010130e10120100000b0000040900000c0600000d
05100800000b000004080000070900000c0000000c0000040a00000c0600000d
0c0f0800000c0000010a0000050400000d0000000c0000060b0000070700000d
0c110800000a000002070000040500000b0000000b0000040a0000060700000d
0e110200010a00000108000006040000090100010d0000050b00000c0500010d
0d100400030c00000409000005030000090200000d0000060b0000080500000c
0f110800040c000006090000060500000e0400020c0000060a0000080600000e
0e120900060b0000060b0000070900000d0200030c0000080c00000d0800000d
0d100a00040c0100050c0000060500000c0100000b0000060c00000e0600010c
0e130800050d000006090000090800000e0300000b0000060c0000080800000f
0f120500040d0100070b00000d0800000c0000000c0000060a00000e0900010e
101309000b110100070c0000100900000f0300010c0000070800000e0900010f
0e140a000b1202000d0d0000100a0000080300000b0000070c0000100a00000e
11160b000d1202000e0b00000f0a00000c0100020b0000090c0000100a00000f


#define X_PROBE_OFFSET_FROM_EXTRUDER (30.6 + 10)  // Z probe to nozzle X offset: -left  +right
#define Y_PROBE_OFFSET_FROM_EXTRUDER (11.6 - 9)   // Z probe to nozzle Y offset: -front +behind

G1 Z -5.0

Bed coord (0 ; 0) relative to new extruder tip at X:2.50 Y:7.50 Z:-3.00 E:0.00 Count X: 2.50 Y:7.50 Z:-3.00 E:0.00

Bed coord (250 ; 0) relative to new extruder tip at X:251.50 Y:7.50 Z:-3.00 E:0.00 Count X: 251.50 Y:7.50 Z:-3.00 E:0.00

Bed reference point 1 (front left) relative to new extruder tip + PINDA offset at X:7.00 Y:3.50 Z:-5.00 E:0.00 Count X: 7.00 Y:3.50 Z:-5.00 E:0.00

PINDA probe offset from extruder tip = 31.0 ; 12.5

Bed reference poin 1 (front left) coord  = ((7.0 - 2.5) + 31) ; ((3.5 - 7.5) + 12.5) = (35.5 ; 8.5)

Bed reference point 3 (rear right) relative to new extruder tip + PINDA offset at X:214.50 Y:195.50 Z:1.00 E:0.00 Count X: 214.50 Y:195.50 Z:1.00 E:0.00

Bed reference poin 3 (rear right) coord  = ((214.5 - 2.5) + 31) ; ((195.5 - 7.5) + 12.5) = (243.0 ; 200.5)

Pattern center [10.500000 6.500000], match 75.757576%
Pattern center [10.500000 5.500000], match 90.909088%
[-4.768815 -7.098472] mm pattern center


count = UStep resolution * mm ?
x=-175 y=-48 --> x=-10.94 y=-3
x=-1126 y=-1930 --> x=-70.4 y=-120.6

WARNING: Front point not reachable. Y coordinate:-6.64 < -4.50 

xyzcal_searchZ x=-300 y=-150 
ON-SIGNAL at x=-722 y=82 z=-745 ad=2508 
[-6.014012 -8.365480] mm pattern center

echo:UStep resolution:
echo: M350 X16 Y16 Z16 E32





----------------------------------------------------------
/** XYZ calibration fails after the front left reference point has been found because the machine fails to move                 \
*   to the next reference point. The calibration continues as if the machine has moved to the 'current_position' coordinates    \
*   even though it is still at the front left reference point. I have noticed that the extruder body crashes into the           \
*   machine when executing the function 'xyzcal_searchZ'. **/

// TODO: I need to verify that the SW travel limits and TMC2130 endstop signals are ignored.

----------------------------------------------------------
current_position[X_AXIS]:4.50000                // Why is current_position[X_AXIS] = 4.5?
current_position[Y_AXIS]:-4.00000               // Why is current_position[Y_AXIS] = -4.0?
current_position[Z_AXIS]:5.00000                                    
xyzcal_find_bed_induction_sensor_point_xy x=700 y=-160 z=2000       // x = 7; y = -1.6
xyzcal_meassure_enter
xyzcal_searchZ x=700 y=-160 z=2000
xyzcal_spiral8 cx=700 cy=-160 z0=2000 dz=100 radius=900 ad=0
xyzcal_spiral2 cx=700 cy=-160 z0=2000 dz=100 radius=900 ad=0
xyzcal_spiral2 cx=700 cy=-160 z0=1900 dz=100 radius=-900 ad=0
xyzcal_spiral2 cx=700 cy=-160 z0=1800 dz=100 radius=900 ad=3
xyzcal_spiral2 cx=700 cy=-160 z0=1700 dz=100 radius=-900 ad=2
xyzcal_spiral8 cx=700 cy=-160 z0=1600 dz=100 radius=900 ad=0
xyzcal_spiral2 cx=700 cy=-160 z0=1600 dz=100 radius=900 ad=0
xyzcal_spiral2 cx=700 cy=-160 z0=1500 dz=100 radius=-900 ad=0
xyzcal_spiral2 cx=700 cy=-160 z0=1400 dz=100 radius=900 ad=3
xyzcal_spiral2 cx=700 cy=-160 z0=1300 dz=100 radius=-900 ad=2
xyzcal_spiral8 cx=700 cy=-160 z0=1200 dz=100 radius=900 ad=0
xyzcal_spiral2 cx=700 cy=-160 z0=1200 dz=100 radius=900 ad=0
xyzcal_spiral2 cx=700 cy=-160 z0=1100 dz=100 radius=-900 ad=0
xyzcal_spiral2 cx=700 cy=-160 z0=1000 dz=100 radius=900 ad=3
xyzcal_spiral2 cx=700 cy=-160 z0=900 dz=100 radius=-900 ad=2
xyzcal_spiral8 cx=700 cy=-160 z0=800 dz=100 radius=900 ad=0
xyzcal_spiral2 cx=700 cy=-160 z0=800 dz=100 radius=900 ad=0
xyzcal_spiral2 cx=700 cy=-160 z0=700 dz=100 radius=-900 ad=0
xyzcal_spiral2 cx=700 cy=-160 z0=600 dz=100 radius=900 ad=3
xyzcal_spiral2 cx=700 cy=-160 z0=500 dz=100 radius=-900 ad=2
xyzcal_spiral8 cx=700 cy=-160 z0=400 dz=100 radius=900 ad=0
xyzcal_spiral2 cx=700 cy=-160 z0=400 dz=100 radius=900 ad=0
xyzcal_spiral2 cx=700 cy=-160 z0=300 dz=100 radius=-900 ad=0
xyzcal_spiral2 cx=700 cy=-160 z0=200 dz=100 radius=900 ad=3
xyzcal_spiral2 cx=700 cy=-160 z0=100 dz=100 radius=-900 ad=2
xyzcal_spiral8 cx=700 cy=-160 z0=0 dz=100 radius=900 ad=0
xyzcal_spiral2 cx=700 cy=-160 z0=0 dz=100 radius=900 ad=0
xyzcal_spiral2 cx=700 cy=-160 z0=-100 dz=100 radius=-900 ad=0
xyzcal_spiral2 cx=700 cy=-160 z0=-200 dz=100 radius=900 ad=3
xyzcal_spiral2 cx=700 cy=-160 z0=-300 dz=100 radius=-900 ad=2
xyzcal_spiral8 cx=700 cy=-160 z0=-400 dz=100 radius=900 ad=0
xyzcal_spiral2 cx=700 cy=-160 z0=-400 dz=100 radius=900 ad=0
xyzcal_spiral2 cx=700 cy=-160 z0=-500 dz=100 radius=-900 ad=0
xyzcal_spiral2 cx=700 cy=-160 z0=-600 dz=100 radius=900 ad=3
xyzcal_spiral2 cx=700 cy=-160 z0=-700 dz=100 radius=-900 ad=2
 ON-SIGNAL at x=270 y=54 z=-745 ad=2508                             // x = 2.7; y = 0.54

0000000000000000000000040800000000000000000000000000000000000000
0000000000000000000c212f170e000000000000000000000500000006000002
0000000000000000264c3336365a360000000000000000000400000005000002
000000000000001e56717a7b7a75333800000000000000000600000005000002
000000000000003e347b7c777879775d1b000000000000000500000002000001
000700000000004e7478776c6c77786c36000000000000000200000005000000
040000000000004f3a786f6a6a75786e3c000000000000000400000002000000
040000000000004635773a6d7078786c33000000000000000200000004000000
04000000000000316374783b7879742c0f000000000000000200000001000000
05000000000000054768737878722e2f00000000000000000500000001000000
0400000000000000173c555d5b4d2a0000000000000000000200000003000000
000000000000000000000f191300000000000000000000000400000000000000
0000000000000000000000000000000000000000000000000600000004000002
0503020000041e0c000000000000000000000000000000000700000006000002
0404070000334d41090000000000000000000000000000000900000005000002
04050600051d2d2c350000000000121b09000000000000000900000007000003
0905050008314b4b370e000000283e4637120000000000000900000007000002
08070800001d2e25211300000a323c3c35170000050000000900000006000004
09060a00000e0e030c0e0000091c181c1f0f0000080200000a00000109000005
090a0b00000b0400000b0000000d0000080800000a0100000900000009000006
0a0c0a0000080300000a00000009000004060000050300000b00000009000006
0c0f0d0000080500000b02000009000001090000080400000b0000000a000008
0d0b0b00000d0900000b0200010a0000080900000b0400010b0000030b00000a
0d090b00000e0700000d0200010b0000050b00000a0500000a0000010b000008
0d0f0b0000070600000c020000090000040700000a0300000c0000010b00000a
0d0c0d02000d0600000c0400010a0000050a0000070500000e0100030b00000a
0e110d0000100700000e0300050c00000b0900000d0900000c0100050c00000c
0e0e0d00000e0900000e0300010a0000050400000b0600000b0000040b00000a
0e110d0000100a00000c0100010c0000040900000b0600000c0100030b00000b
0e110c00000f0800000f0400040c0000040800000b0300000e0100020b00000b
10130c0000100900000f0400040c0000090b00000a0400000e0400030c00000b
10130e0102110a00020f0400050d0000080b00000e0500000c0100030c00000c

Pattern center [10.500000 5.500000], match 75.000000%
Pattern center [11.500000 5.500000], match 91.666664%
 [11.500000, 5.500000][4.500000] start circle
 [11.500000, 5.500000][4.500000] circle
 [11.445045, 5.626291][4.954712] circle
 [11.258445, 5.767600][5.080647] circle
 [11.259969, 5.821774][5.056777] circle
 [11.245332, 5.851122][5.039577] circle
 [11.242330, 5.851122][5.041566] circle
 [11.239371, 5.849643][5.039952] circle
 [11.236759, 5.848311][5.038498] circle
 [11.236076, 5.847140][5.038130] circle
 [11.236510, 5.846395][5.038364] circle
 [11.235029, 5.846090][5.038032] circle
 [11.236326, 5.845287][5.038994] circle
 [11.234292, 5.844924][5.038599] circle
 [11.235368, 5.843803][5.039178] circle
 [11.233476, 5.843430][5.038770] circle
 [11.234253, 5.842397][5.039345] circle
 [11.232499, 5.841891][5.038793] circle
 [11.232853, 5.840980][5.039675] circle
 [11.231252, 5.840048][5.038812] circle
 [11.231100, 5.839240][5.040149] circle
 [11.230450, 5.839097][5.040077] final circle
 [4.267488 -7.782979] mm pattern center
xyzcal_meassure_leave
Measured:
4.27
-7.77

pt[0]:4.27
pt[1]:-7.77

// Why is the pinda reference point found at x = 4.27 and y = -7.77??
// Which coordinate system is used here?

// TODO: I need to find the relation between the World and Machine coordinate systems to the extruder/nozzle spatial characteristic.

// TODO: I need to find the coordinate system reference point (x=0 ; y=0) that pt[0]:4.27 pt[1]:-7.77 references,
// and compare it to any known reference point of the coordinate systems (World, Machine, Bed, Print Area, Build Plate)


// The calibration continues as if the machine has moved to the 'current_position' coordinates    
// even though it is still at the front left reference point:
current_position[X_AXIS]:212.00000
current_position[Y_AXIS]:-4.00000
current_position[Z_AXIS]:0.95750
xyzcal_find_bed_induction_sensor_point_xy x=427 y=-777 z=-817
xyzcal_meassure_enter
xyzcal_searchZ x=427 y=-777 z=-817
xyzcal_spiral8 cx=427 cy=-777 z0=-817 dz=100 radius=900 ad=0
xyzcal_spiral2 cx=427 cy=-777 z0=-817 dz=100 radius=900 ad=0
 ON-SIGNAL at x=427 y=-777 z=-817 ad=34

000000123728170a2720542d451e0000000000032e27293939222c3c1a13313f
00001f003c241b39617c488c7e2c1200000000233e311b44202d3a4421194249
00063b3c20103b729db3b6b7af9e6b15000000251f313645402f3b463e184349
0834211e00125f9ababfbfc2c0bc9f5c000000283f31352241183c463c322048
17213000001c3bb0bfbdb9b9bdc1b4802400002e401a3646412c39483f1a214b
39411500002884b2bcb7acb0b8bfba923e00002d41191a483f173b473d304247
3a3a0200002180afb8b4aaaeb6bfb78f3f00002c3b2e1a453f2c3846382c3e46
3b340000000b72a5b5b6b1b4bbbcb181270000273b3218463f2e3844392d3f44
3c1a000000005392b0b8bbbcbeba9d60000000233b191a474130384638324249
3e1b000000001f6e96adb3b6b0a0721b000000113d333648423038493d194147
3e3a010000000032657d8b8b815e19000000001c3b351b463d2d3b461d304245
3f3f1000000000000c273a3622000000000000221e3135483f2c37463d2e4248
42412300112d25000000000000000000000000263e333548423239471d344148
414832285274713600000000000000000000002d4233374840343c4a3d36414b
414a3d4272979a732000000000101f10000000364419374a44303d4b3a19424d
454a3e42729b9e87540200003f6775684013163b4332364a432f3d493e35434c
462940403240437c61350f3268828a4063362c2146333949432e3e4c3d34414a
49513f3c5665602f2d45314668753b75623d31474632364b432f3c4f4036454c
474e40374a5043475346374356534c565338374446331d4d452f3d4b3f36454a
2452211d4a4b37354f47364051243b46493838494a383c4b22313d4e421b444f
4952413a494d373a4e481a3c50441a454d39384c4838394842333f50431b454e
4a53413b4d4e383e4f4933404f413643283a1b27271c3a4f433241514237464e
4b55213c4e28211c4d4937434f3f37454c3d364c4a1d204e42334350431d464f
4e55202050503a3d294b37444f4033474e3b344c4b393e504734425142374650
4f56224050513b3f5048194351423645513a374d4a3a3d514736415145384d51
2758464050523a41512436415244344a4f423a4e4d3e4351463a4452453d4b50
4e2c46005756413f534c3b4552443747513a385050373f524c384252441d4f52
515a464250543f42294f364352423645503e374e50374256283b442943384f51
515c472053554221294d3a435145374c523e3c4f4f3a46542538445321395152
525b4820542a4144554c384251433a4b52403851523c4354483a455146394d50
525a473f52534240532738435143374a273e37504d3c44524637435342384f50
5059494153523d425552394152433625523d3a4f4d394052453a435445374c51

Pattern center [12.500000 6.500000], match 67.424240%
Pattern center [11.500000 6.500000], match 77.272728%
 [11.500000, 6.500000][4.500000] start circle
 [11.500000, 6.500000][4.500000] circle
 [11.256380, 6.279591][5.000000] circle
 [10.815489, 5.859201][5.500000] circle
 [10.555878, 5.625824][5.739151] circle
 [10.530405, 5.566317][5.744544] circle
 [10.508688, 5.544884][5.729540] circle
 [10.502397, 5.544283][5.740202] circle
 [10.505055, 5.543598][5.745841] circle
 [10.503418, 5.542037][5.744710] circle
 [10.505228, 5.542037][5.747462] circle
 [10.502379, 5.539321][5.745494] circle
 [10.504829, 5.539321][5.750288] circle
 [10.500739, 5.535421][5.747462] circle
 [10.503881, 5.535421][5.754128] circle
 [10.498838, 5.530612][5.750643] circle
 [10.501516, 5.530612][5.758615] circle
 [10.497202, 5.526498][5.755634] circle
 [10.500820, 5.526498][5.762908] circle
 [10.494702, 5.520665][5.758681] circle
 [10.497145, 5.520665][5.768503] circle
 [10.492665, 5.517197][5.765409] final circle
 [1.065306 -14.158994] mm pattern center
xyzcal_meassure_leave
Measured:
1.07
-14.15

pt[0]:1.07
pt[1]:-14.15

// TODO: Why does the machine not move to the next reference point?





----------------------------------------------------------
changed FIND_BED_INDUCTION_SENSOR_POINT_X_RADIUS and Y_RADIUS from 8 to 4 and 4 to 2 respectively:

current_position[X_AXIS]:4.50000
current_position[Y_AXIS]:-4.00000
current_position[Z_AXIS]:5.00000
xyzcal_searchZ x=700 y=-160 z=2000

----------------------------------------------------------
// ISSUE G28 Homing:
// M114 reports X:5.25 Y:6.80 instead of X:0.00 Y:0.00 after homing by G28 even though X and Y carriages rests at machine limits. 

// Why does the machine not reset the xy coordinates?
// TODO: Figure it out, good luck lol!

// gcode_G28() has parameter 'calib' where
// if(home_x)
//	  {
//		if (!calib)
//			homeaxis(X_AXIS);
//		else
//			tmc2130_home_calibrate(X_AXIS);
//	  }

// gcode_G28() has parameters 'home_x_axis' and 'home_x_value' where
// if(home_x_axis && home_x_value != 0)
//      current_position[X_AXIS]=home_x_value+cs.add_homing[X_AXIS];

Print settings from memory (currently loaded settings, not EEPROM):

SENDING:M503
Steps per unit:
M92 X100.00 Y100.00 Z400.00 E786.50
UStep resolution:
M350 X16 Y16 Z16 E32
Maximum feedrates - normal (mm/s):
M203 X200.00 Y200.00 Z12.00 E120.00
Maximum feedrates - stealth (mm/s):
M203 X100.00 Y100.00 Z12.00 E120.00
Maximum acceleration - normal (mm/s2):
M201 X1000 Y1000 Z200 E5000
Maximum acceleration - stealth (mm/s2):
M201 X960 Y960 Z200 E5000
Acceleration: P=print, R=retract, T=travel
M204 P1250.00 R1250.00 T1250.00
Advanced variables: S=Min feedrate (mm/s), T=Min travel feedrate (mm/s), B=minimum segment time (ms), X=maximum XY jerk (mm/s),  Z=maximum Z jerk (mm/s),  E=maximum E jerk (mm/s)
M205 S0.00 T0.00 B0.00 X10.00 Y10.00 Z0.40 E4.50
Home offset (mm):
M206 X2.00 Y4.00 Z0.00
PID settings:
M301 P33.76 I3.52 D80.92
PID heatbed settings:
M304 P126.13 I4.30 D924.76
Retract: S=Length (mm) F:Speed (mm/m) Z: ZLift (mm)
M207 S3.00 F2700.00 Z0.00
Recover: S=Extra length (mm) F:Speed (mm/m)
M208 S0.00 F480.00
Auto-Retract: S=0 to disable, 1 to interpret extrude-only moves as retracts or recoveries
M209 S0
Filament settings: Disabled
Arc Settings: P:Max length(mm) S:Min length (mm) N:Corrections R:Min segments F:Segments/sec.
M214 P1.00 S0.50 N25 R20 F0
Temperature Model settings:
M310 I0 R20.50
M310 I1 Rnan
M310 I2 Rnan
M310 I3 Rnan
M310 I4 Rnan
M310 I5 Rnan
M310 I6 Rnan
M310 I7 Rnan
M310 I8 Rnan
M310 I9 Rnan
M310 I10 Rnan
M310 I11 Rnan
M310 I12 Rnan
M310 I13 Rnan
M310 I14 Rnan
M310 I15 Rnan
M310 P38.00 C12.10 S0 B1 E1.74 W1.20 T-7.00


Read parameters from EEPROM

SENDING:M501
TM: stored calibration invalid, resetting
Stored settings retrieved

Print settings from memory (currently loaded settings, not EEPROM):
SENDING:M503
Steps per unit:
M92 X100.00 Y100.00 Z400.00 E786.50
UStep resolution:
M350 X16 Y16 Z16 E32
Maximum feedrates - normal (mm/s):
M203 X200.00 Y200.00 Z12.00 E120.00
Maximum feedrates - stealth (mm/s):
M203 X100.00 Y100.00 Z12.00 E120.00
Maximum acceleration - normal (mm/s2):
M201 X1000 Y1000 Z200 E5000
Maximum acceleration - stealth (mm/s2):
M201 X960 Y960 Z200 E5000
Acceleration: P=print, R=retract, T=travel
M204 P1250.00 R1250.00 T1250.00
Advanced variables: S=Min feedrate (mm/s), T=Min travel feedrate (mm/s), B=minimum segment time (ms), X=maximum XY jerk (mm/s),  Z=maximum Z jerk (mm/s),  E=maximum E jerk (mm/s)
M205 S0.00 T0.00 B0.00 X10.00 Y10.00 Z0.40 E4.50
Home offset (mm):
M206 X2.00 Y4.00 Z0.00
PID settings:
M301 P33.76 I3.52 D80.92
PID heatbed settings:
M304 P126.13 I4.30 D924.76
Retract: S=Length (mm) F:Speed (mm/m) Z: ZLift (mm)
M207 S3.00 F2700.00 Z0.00
Recover: S=Extra length (mm) F:Speed (mm/m)
M208 S0.00 F480.00
Auto-Retract: S=0 to disable, 1 to interpret extrude-only moves as retracts or recoveries
M209 S0
Filament settings: Disabled
Arc Settings: P:Max length(mm) S:Min length (mm) N:Corrections R:Min segments F:Segments/sec.
M214 P1.00 S0.50 N25 R20 F0
Temperature Model settings:
M310 I0 R20.50
M310 I1 Rnan
M310 I2 Rnan
M310 I3 Rnan
M310 I4 Rnan
M310 I5 Rnan
M310 I6 Rnan
M310 I7 Rnan
M310 I8 Rnan
M310 I9 Rnan
M310 I10 Rnan
M310 I11 Rnan
M310 I12 Rnan
M310 I13 Rnan
M310 I14 Rnan
M310 I15 Rnan
M310 P38.00 C12.10 S0 B1 E1.74 W1.20 T-7.00

TODO: What does 'Home offset (mm): M206 X2.00 Y4.00 Z0.00' mean, and what defines it? 
TODO: What sets 'Home offset'?

Marlin_main.cpp defines M206 as 'set additional homing offset'

From https://marlinfw.org/docs/gcode/M206.html: 
Use M206 to apply a persistent offset to the native home position and coordinate space. 
This effectively shifts the coordinate space in the negative direction. See examples below.

* The current position is adjusted to align to the new home offset values.
* The home offset is persistent â€” added to the current position until changed.
* Some uses include fine adjustment of Z position (without moving endstops) and shifting the coordinate space to print on a different part of the bed.

// TODO: Find the impact of Home offset by setting it to '0;0;0'.
// Set current settings 'cs' to default settings 'default_conf':
SENDING:M502
Hardcoded Default Settings Loaded

// Read current settings:
SENDING:M503
Steps per unit:
M92 X100.00 Y100.00 Z400.00 E786.50
UStep resolution:
M350 X16 Y16 Z16 E32
Maximum feedrates - normal (mm/s):
M203 X200.00 Y200.00 Z12.00 E120.00
Maximum feedrates - stealth (mm/s):
M203 X100.00 Y100.00 Z12.00 E120.00
Maximum acceleration - normal (mm/s2):
M201 X1000 Y1000 Z200 E5000
Maximum acceleration - stealth (mm/s2):
M201 X960 Y960 Z200 E5000
Acceleration: P=print, R=retract, T=travel
M204 P1250.00 R1250.00 T1250.00
Advanced variables: S=Min feedrate (mm/s), T=Min travel feedrate (mm/s), B=minimum segment time (ms), X=maximum XY jerk (mm/s),  Z=maximum Z jerk (mm/s),  E=maximum E jerk (mm/s)
M205 S0.00 T0.00 B0.00 X10.00 Y10.00 Z0.40 E4.50
Home offset (mm):
M206 X0.00 Y0.00 Z0.00
PID settings:
M301 P16.13 I1.16 D56.23
PID heatbed settings:
M304 P126.13 I4.30 D924.76
Retract: S=Length (mm) F:Speed (mm/m) Z: ZLift (mm)
M207 S3.00 F2700.00 Z0.00
Recover: S=Extra length (mm) F:Speed (mm/m)
M208 S0.00 F480.00
Auto-Retract: S=0 to disable, 1 to interpret extrude-only moves as retracts or recoveries
M209 S0
Filament settings: Disabled
Arc Settings: P:Max length(mm) S:Min length (mm) N:Corrections R:Min segments F:Segments/sec.
M214 P1.00 S0.50 N25 R20 F0
Temperature Model settings:
M310 I0 R20.50
M310 I1 Rnan
M310 I2 Rnan
M310 I3 Rnan
M310 I4 Rnan
M310 I5 Rnan
M310 I6 Rnan
M310 I7 Rnan
M310 I8 Rnan
M310 I9 Rnan
M310 I10 Rnan
M310 I11 Rnan
M310 I12 Rnan
M310 I13 Rnan
M310 I14 Rnan
M310 I15 Rnan
M310 P38.00 C12.10 S0 B1 E1.74 W1.20 T-7.00

// Store Current settings to EEPROM:
SENDING:M500
Settings Stored

// Verify that EEPROM has the new settings:
// Load EEPROM settings:
SENDING:M501
TM: stored calibration invalid, resetting
Stored settings retrieved

// Print current settings:
SENDING:M503
Steps per unit:
M92 X100.00 Y100.00 Z400.00 E786.50
UStep resolution:
M350 X16 Y16 Z16 E32
Maximum feedrates - normal (mm/s):
M203 X200.00 Y200.00 Z12.00 E120.00
Maximum feedrates - stealth (mm/s):
M203 X100.00 Y100.00 Z12.00 E120.00
Maximum acceleration - normal (mm/s2):
M201 X1000 Y1000 Z200 E5000
Maximum acceleration - stealth (mm/s2):
M201 X960 Y960 Z200 E5000
Acceleration: P=print, R=retract, T=travel
M204 P1250.00 R1250.00 T1250.00
Advanced variables: S=Min feedrate (mm/s), T=Min travel feedrate (mm/s), B=minimum segment time (ms), X=maximum XY jerk (mm/s),  Z=maximum Z jerk (mm/s),  E=maximum E jerk (mm/s)
M205 S0.00 T0.00 B0.00 X10.00 Y10.00 Z0.40 E4.50
Home offset (mm):
M206 X0.00 Y0.00 Z0.00
PID settings:
M301 P16.13 I1.16 D56.23
PID heatbed settings:
M304 P126.13 I4.30 D924.76
Retract: S=Length (mm) F:Speed (mm/m) Z: ZLift (mm)
M207 S3.00 F2700.00 Z0.00
Recover: S=Extra length (mm) F:Speed (mm/m)
M208 S0.00 F480.00
Auto-Retract: S=0 to disable, 1 to interpret extrude-only moves as retracts or recoveries
M209 S0
Filament settings: Disabled
Arc Settings: P:Max length(mm) S:Min length (mm) N:Corrections R:Min segments F:Segments/sec.
M214 P1.00 S0.50 N25 R20 F0
Temperature Model settings:
M310 I0 R20.50
M310 I1 Rnan
M310 I2 Rnan
M310 I3 Rnan
M310 I4 Rnan
M310 I5 Rnan
M310 I6 Rnan
M310 I7 Rnan
M310 I8 Rnan
M310 I9 Rnan
M310 I10 Rnan
M310 I11 Rnan
M310 I12 Rnan
M310 I13 Rnan
M310 I14 Rnan
M310 I15 Rnan
M310 P38.00 C12.10 S0 B1 E1.74 W1.20 T-7.00

// Run G28 with zero 'Home offset':
SENDING:G28
tmc2130_home_enter(axes_mask=0x01)
  0 step=30 mscnt= 482
tmc2130_goto_step 0 29 2 1000
tmc2130_home_exit tmc2130_sg_homing_axes_mask=0x01
tmc2130_home_enter(axes_mask=0x02)
  0 step= 1 mscnt=  29
tmc2130_goto_step 1 33 2 1000
tmc2130_home_exit tmc2130_sg_homing_axes_mask=0x02
enqueing "M83"
enqueing "G1 E-1.000 F2700"
enqueing "G1 Z15.000 F800.000"
enqueing "CRASH_DETECTEDX"
endstops hit:  X:-1.75
LCD status changed
tmc2130_home_enter(axes_mask=0x01)
  0 step=30 mscnt= 481
tmc2130_goto_step 0 29 2 1000
tmc2130_home_exit tmc2130_sg_homing_axes_mask=0x01
tmc2130_home_enter(axes_mask=0x02)
  0 step=33 mscnt= 541
tmc2130_goto_step 1 33 2 1000
tmc2130_home_exit tmc2130_sg_homing_axes_mask=0x02
enqueing "CRASH_RECOVER"
Resend: 0
LCD status changed


// Home offset (mm): M206 X2.00 Y4.00 Z0.00 (original values)
SENDING:M114
X:5.25 Y:6.80 

// Home offset (mm): M206 X0.00 Y0.00 Z0.00 (zeroed values)
SENDING:M114
X:3.24 Y:2.80 Z:5.00 E:0.00 Count X: 0.00 Y:-4.00 Z:5.00 E:0.00

---------------------------------------------------------------------------------------------------
Redefined machine coordinate system: Travel limits = Bed print area + home offset

Added XYZ_CAL_SEARCH_RADIUS 450 to prevent x- and y carriage crash on 'xyzcal_searchZ'
There is still an issue with x-carriage crash when finding xy coordinates of the reference point.
// TODO: Investigate x-carriage crash.

XYZ calibration finds all 4 reference points, but crashes on 3x3 mesh bed calibration.
On the 9th calibration point z-axis crashes into build plate, ignoring SW travel limit, without triggering a crash.
For some reason 7x7 mesh calibration works. 
---------------------------------------------------------------------------------------------------
G28, initial world coordinates: (4.504, -0.782, 0.150)
G28, initial physical coordinates: (1.760, -7.500, 0.150)
World - Physical
4.504 - 1.760 = 2.744 = 2.75 = X
-0.782 - -7.5 = 6.718 = 6.72 = Y


